<!DOCTYPE html>
<html>
    <head>
        <title>Exposure Same Different</title>
        <script src='jatos.js'></script>
        <script src='./jspsych-6.3.1/jspsych.js'></script>        
        <script src='./extra_functions/lodash.js'></script>
        <script src = './extra_functions/jquery-3.4.1.js' type='text/javascript'></script>
        <script src="./jspsych-6.3.1/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="./extra_functions/jspsych-exposure-keyboard-response.js"></script>
        <script src="./jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="./jspsych-6.3.1/plugins/jspsych-preload.js"></script>
        <link href='./jspsych-6.3.1/css/jspsych.css' rel='stylesheet' type='text/css'></link>
        <link href='./extra_files/custom.css' rel='stylesheet' type='text/css'></link>
    </head>
    <body></body>
    <script>

        jatos.onLoad(function() {
            
            // Create the snippets for stimulus trials
            var session_trials = jatos.studySessionData.inputData.exposure_trials

            // For the fixation trials, create an html element of a blank arena, with the prompt text
            let fixation_arena_element = document.createElement('div')
            fixation_arena_element.id = 'arena'

            let fixation_prompt_element = document.createElement('P')
            fixation_prompt_element.textContent = 'Is the bird the same as the one before? 1=same, 2=different'
            fixation_prompt_element.className = 'exposure_prompt_text'
            fixation_arena_element.appendChild(fixation_prompt_element)

            // Create a gray squared mask
            let mask_arena_element = document.createElement('div')
            mask_arena_element.id = 'arena'

            let mask_prompt_element = document.createElement('P')
            mask_prompt_element.textContent = 'Is the bird the same as the one before? 1=same, 2=different'
            mask_prompt_element.className = 'exposure_prompt_text'

            let mask_square = document.createElement('div')
            mask_square.id = 'mask'

            mask_arena_element.appendChild(mask_prompt_element)
            mask_arena_element.appendChild(mask_square)

            var mask_trial = {
                type: 'html-keyboard-response',
                stimulus: mask_arena_element.outerHTML,
                choices: jsPsych.NO_KEYS,
                trial_duration: jatos.studySessionData.mask_duration,
            }

            var fixation_trial = {
                type: 'exposure-keyboard-response',
                prompt: 'Is the bird the same as the one before? Press 1 for same, 2 for different.',
                choices: jsPsych.NO_KEYS,
                stimulus: 'img/fixation.png',
                x_offset: 0,
                y_offset: 100,
                trial_duration: 500,
                response_ends_trial: false,                
            }

            var exposure_trial = {
                type: 'exposure-keyboard-response',
                prompt: 'Is the bird the same as the one before? Press 1 for same, 2 for different.',
                choices: ['1','2'],
                stimulus: jsPsych.timelineVariable('stimulus'),
                x_offset: jsPsych.timelineVariable('x_offset'),
                y_offset: jsPsych.timelineVariable('y_offset'),
                trial_duration: 3000,
                response_ends_trial: true,                
            }

            var session_procedure = {
                timeline: [exposure_trial,fixation_trial],
                timeline_variables: session_trials,
                randomize_order: false,
                post_trial_gap: 0,
            }
            
            var preload = {
                type: 'preload',
                auto_preload: true,
                show_progress_bar: true, 
            }

            jsPsych.init({
                timeline: [preload,session_procedure],  
                // show_progress_bar: true,                 
              
                on_finish: function(data) {
                    console.log('Over');
                    jsPsych.data.displayData('json');
                }       
            });
   
            // ///////////////////////////////////////////////////////////////////////////////////////////////
            //////////////////////////////////////////////////////////////////////////////////////////////////
        });
    
    </script>
</html>
